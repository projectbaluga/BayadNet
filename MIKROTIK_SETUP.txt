# Mikrotik Configuration for Payment Reminder Redirect

# 1. Create the Payment Reminder Profile
# This profile limits bandwidth (optional) and adds the user to an address list.
# Ensure 'pppoe-pool' is the name of your IP pool.
/ppp profile
add name="payment-reminder" rate-limit=512k/512k address-list=overdue_users \
    comment="Profile for overdue subscribers - redirects to payment reminder"

# 2. Create a NAT Rule to Redirect HTTP Traffic
# Redirects TCP port 80 traffic from 'overdue_users' to your server's Payment Reminder Page.
# Replace <YOUR_SERVER_IP> with the IP address of your server running the BayadNet app (e.g., 192.168.88.254).
# Ensure your server accepts connections on port 3000 (or 80 if behind Nginx).

/ip firewall nat
add chain=dstnat action=dst-nat to-addresses=<YOUR_SERVER_IP> to-ports=3000 \
    protocol=tcp dst-port=80 src-address-list=overdue_users \
    comment="Redirect Overdue Users to Payment Reminder Page"

# 3. Create a Filter Rule to Block Other Traffic (Optional)
# Block everything else for overdue users except DNS and the connection to your server.
/ip firewall filter
add chain=forward action=accept src-address-list=overdue_users protocol=udp dst-port=53 comment="Allow DNS"
add chain=forward action=accept src-address-list=overdue_users dst-address=<YOUR_SERVER_IP> comment="Allow Access to Server"
add chain=forward action=drop src-address-list=overdue_users comment="Block Everything Else for Overdue"
